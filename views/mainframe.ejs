<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"> 
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title %></title>
    <link href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/themes/base/jquery-ui.css" rel="stylesheet" type="text/css"/> 
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.5/jquery.min.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/jquery-ui.min.js"></script> 
    <script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
    <script type="text/javascript">   

    //console.log(new Date());
    // $(document).ready( function() {
    //     // $("#header").load('/views/header.html');
    //     $("#header").render('/views/header.html');

    //     // $("#leftside").load("common/leftside.html");  
    // });
    // </script>
    <link rel="stylesheet" href="/public/mainframe_shortcuts.css">
    <link rel="stylesheet" href="/public/mainframe.css">
    <link rel="stylesheet" href="/public/font.css">

    <link rel="stylesheet" type="text/css" href="/public/header.css"/>
    <link rel="stylesheet" type="text/css" href="/public/component.css"/>
</head>

<body>
    <div id="wrap">
        <div id="header" role="banner">
            <div class="main_header">
                <!-- 여기는 상단 헤더 (로고, 메뉴버튼들) -->
                <div class="logo_area">
                    <a href="#" class="logo_tight"><img src="/logo/logo_lower.png" class=img_logo onclick="location.href='/'" alt=""/></a>
                    <section class="group_menu">
                        <nav class="menu_effect" id="menu_nav">
                            <a href="/" class="menu" id="menu_home">내 공부방</a>
                            <a href="/guestbook" class="menu" id="menu_guestbook">방명록</a>
                            <a href="/timetable/main" class="menu" id="menu_timetable">시간표</a>
                        </nav>
                    </section>
                </div>
                <script type="text/javascript">   
                    $(document).ready( function() {
                        const location = window.location.pathname;
                        console.log('현재 url:'+location);
                        if (location == '/') {
                            // $('#menu_home').css({'outline': 'none', 'color':'#6ED4D8', 'text-decoration-color': '#6ED4D8', 'font-weight': '700' });
                            $('#menu_home').addClass('menu_active');
                            $('#menu_guestbook').removeClass('menu_active');
                            $('#menu_timetable').removeClass('menu_active');
                        } else if (location == '/guestbook') {
                            $('#menu_guestbook').addClass('menu_active');
                            $('#menu_home').removeClass('menu_active');;
                            $('#menu_timetable').removeClass('menu_active');
                        } else if (location == '/timetable/main' || location == '/timetable/edit') {
                            $('#menu_timetable').addClass('menu_active');
                            $('#menu_home').removeClass('menu_active');
                            $('#menu_guestbook').removeClass('menu_active');
                        } else {
                            $('#menu_home').removeClass('menu_active');
                            $('#menu_guestbook').removeClass('menu_active');
                            $('#menu_timetable').removeClass('menu_active');
                        }
                        
                    });
                    
                </script>
                <div class="login">
                        <div class="profile_section">
                            <% if (user) { %> <%# 로그인 되어 있는 경우 (server에서 접속중인 user 정보 받아옴) %> 
                            <div class="alarm_bell">
                                <img id="alarm_bell_img" src="/public/media/bell_pure.png">
                            </div>
                            <div class="profile">
                                <!-- 이미지 클릭시 프로필 관리 화면으로 가는것도 좋을듯 -->
                                <img id="activeUserimg" src=<%= user.profile_image %>  onclick="location.href='#프로필수정화면'">
                                <div class="username" id="activeUsername"><%= user.name +'님'%></div> 
                            </div>
                            <div class="logout">
                                <input type="submit" class="btn_logout" title="로그아웃" value="로그아웃" onClick="location.href='/auth/logout'"/>    
                            </div>
                            <% } %>
                            <!-- 로그인 되어있지 않은 경우는 로그인 화면으로 넘어가야 하기 때문에 아래 코드는 필요없음 -->
                            <!-- <%# } else{ %> 
                            <div class="logout">
                                <input type="button" class="btn_logout" title="로그인" value="로그인" onclick="location.href='/login'" />
                            </div>
                            <%# } %> -->
                        </div>
                    </div>
                </div>
            </div>
        </div>


    
        <div id="container" role="main">
            <div id="shortcuts_wrap">
                <div class="shortcuts_title" id="shortcuts_title">현재 시간표에 등록된 일정이 없습니다</div>
                <div class="shortcuts_link" id="shortcuts_link" onclick="openLink();">바로가기</div>
            </div>
            <script type="text/javascript">

                function openLink() { //바로가기 버튼 누른경우
                    if (isopen && isonline) { //실시간 수업 있는경우 링크로 이동
                        var win = window.open(link, '_blank');
                        win.focus();
                    } else if (isopen && !isonline) {
                        alert('온라인 강의가 아닙니다.');
                    } else {
                        if (isonline) {
                            alert('현재 등록된 강의 링크가 없습니다.');
                        } else {
                            alert('현재 시간표에 등록된 일정이 없습니다');
                        }
                    }
                }

                function getRealtimeCourse(course) {
                    var type, tmptime, day, st, sh, sm, et, eh, em;
                    var date = new Date();
                    //현재 시간
                    var curday = date.getDay();
                    var curhour = date.getHours();
                    var curmin = date.getMinutes();

                    // 오프라인 - 테스트용
                    // var curday = 4;
                    // var curhour = 12;
                    // var curmin = 13;

                    //온라인 - 테스트용 
                    // var curday = 1; //월요일
                    // var curhour = 11;  // 오전 11시
                    // var curmin = 46; //46분

                    var cur = (curhour * 3600) + (curmin * 60); //현재시간 초단위로 변환
                    for (var i = 0; i < course.schedules.length; i++) {
                        tmptime = course.schedules[i];
                        day = dayStrToNum(tmptime.day); //요일을 번호로 바꿔서 저장
                        st = tmptime.start_time.split(':'); //시,분으로 나누기
                        sh = Number(st[0]); //시작 시
                        sm = Number(st[1]); //시작 분
                        et = tmptime.end_time.split(':');
                        eh = Number(et[0]); //종료 시
                        em = Number(et[1]); //종료 분
                        if (day == curday) { //요일 비교
                            var starttime = (sh * 3600) + (sm * 60); //시작시간 초단위로 변환
                            var endtime = (eh * 3600) + (em * 60);
                            var gap = starttime - cur; //수업 시작까지 남은시간 계산
                            if (gap >= 0 && gap <= 1800) { //30분 이내에 수업이 있는 경우
                                type = getCourseType(course.schedules[i].course_type);
                                return {
                                    message : tmptime.start_time + ' ~ ' + tmptime.end_time + ' '+ course.course_name,
                                    type : course.schedules[i].course_type,
                                    classroom : course.schedules[i].classroom
                                }; //시간 과목이름 과목종류 리턴
                            } else if (starttime <= cur && cur <= endtime) { //수업이 종료될 때 까지 계속 띄워두기
                                type = getCourseType(course.schedules[i].course_type);
                                return {
                                    message : tmptime.start_time + ' ~ ' + tmptime.end_time + ' '+ course.course_name,
                                    type : course.schedules[i].course_type,
                                    classroom : course.schedules[i].classroom
                                }; //시간 과목이름 과목종류 리턴
                            }
                        }
                    }
                    return null;
                }

                function getCourseType(type) { //과목 타입(online_realtime,online_video,offline)
                    switch (type) {
                        case 'online_realtime':
                            return "온라인 실시간";
                        case 'online_video':
                            return "온라인 동영상";
                        case 'offline': //오프라인이면 강의실 리턴
                            return '오프라인';
                    }
                }

                function dayStrToNum(day) {
                    switch (day) {
                        case 'mon':
                            return 1;
                        case 'tue':
                            return 2;
                        case 'wed':
                            return 3;
                        case 'thu':
                            return 4;
                        case 'fri':
                            return 5;
                        case 'sat':
                            return 6;
                        case 'sun':
                            return 0;
                    }
                }

                //$(document).ready( function() {
                    var isopen = false;
                    var isonline = false;
                    var course;
                    var timetable = JSON.parse('<%- JSON.stringify(timetable) %>');
                    
                        for (var i = 0; i < timetable.length; i++) {
                        course = getRealtimeCourse(timetable[i]); //courselist에서 실시간 강의 찾기
                        if (course != null) { //30분이내 실시간 강의 있는 경우
                            isopen = true;
                            // console.log(course);
                            if (course.type === 'offline') { // 오프라인일 경우 메시지에 장소 추가
                                course.message = course.message + ' ('+course.classroom+')';
                            } else { //온라인일 경우 링크 넣기
                                isonline = true;
                                link = course.classroom; // [바로가기]클릭시 이동될 링크
                            }
                            break;
                        }
                    }
                    
                    if (isopen) { // 실시간 일정 있는 경우
                            $('#shortcuts_title').html(course.message);
                        if (isonline) {
                            //document.getElementById("shortcuts_link").style.color = "blue";
                            $('#shortcuts_link').css({color:"blue"});
                        }
                    }
                //});
            </script>
            <div id="MAIN_LEFT" class="column_left">
                <div class="section">
                    <!-- 여기는 본문 들어갈 메인 섹션 -->
                    <div class="D-day" id="D-day">
                        <div class="wrap_day" id="wrap_day">
                        <script>
                            function deleteDay(content,index){
                                //console.log(content,index);
                            
                                var parent_day=document.getElementById('wrap_day')
                                var delete_day=document.getElementsByClassName('d-day')[index];

                                //DB에서 삭제되도록
                                fetch('/day',{
                                        method:'DELETE',
                                        headers:{
                                            'Accept':'application/json',
                                            'Content-Type':'application/json'
                                        },
                                        body:JSON.stringify({user_id:'<%= user.name %>',dday_content:content})
                                        //.then(res => res.json())   
                                    });
                                parent_day.removeChild(delete_day);
                                alert(content+'이(가) d-day에서 삭제되었습니다.');
                            
                                // 디데이 개수 체크
                                var parent_day=document.getElementById('wrap_day');
                                var childCnt = parent_day.childElementCount;
                                console.log('자식 개수:'+childCnt);
                                var invisible_plus=document.getElementById('d-day-plus');
                                if (childCnt > 9) { // <script>2개, d-day 8개 => 총 10개
                                    invisible_plus.style.display='none';
                                } 
                                // else if (childCnt == 9 && invisible_plus.style.display=='none') {
                                //     invisible_plus.style.display= 'none';
                                // } 
                                else {
                                    invisible_plus.style.display='inline-block';
                                }
                                // var d_daylist = JSON.parse('<%- JSON.stringify(d_day) %>');
                                // var invisible_plus=document.getElementById('d-day-plus');
                                // if(d_daylist.length>=8){
                                    
                                //     invisible_plus.style.display='none';
                                // }else{
                                //     invisible_plus.style.display='inline-block';
                                // } 
                            }
                        </script>
                        <script>
                            var parentDiv = document.getElementById("wrap_day")
                            var d_daylist = JSON.parse('<%- JSON.stringify(d_day) %>');
                            //console.log(d_daylist.length);
                            
                            for (var i = 0; i < d_daylist.length; i++) {
                                
                                
                                var show_day = document.createElement("div");
                                var show_content = document.createElement("span");
                                var delete_day=document.createElement('span');
                                delete_day.setAttribute('class','delete_day');
                                
                                delete_day.innerHTML= '&times;';
                                show_day.setAttribute("class", "d-day")
                                show_content.setAttribute("class", "d-date")
                                var tmp = d_daylist[i]; //해당 나온 날짜와 내용을 tmp에 넣음
                                show_content.innerHTML = tmp.dday_content
                                //console.log(show_content.innerHTML);
                                // 디데이 계산하기
                                var date1 = new Date(tmp.start_date);
                                var date2 = new Date(tmp.final_date);
                                var gap = date2.getTime() - date1.getTime();
                                var ddayResult = Math.ceil(gap/(1000*60*60*24));

                                delete_day.setAttribute('value',tmp.dday_content);
                                const content=delete_day.getAttribute('value');
                                const index=i;
                                //console.log(content);
                                delete_day.addEventListener('click',function(){
                                    
                                    deleteDay(content,index);
                                })
                                show_day.innerHTML="D-"+ddayResult
                                //showrs_day.innerHTML = "D-" + --tmp.day;
                                show_day.append(delete_day);
                                show_day.append(show_content);
                                parentDiv.append(show_day);
                                show_day.style.fontWeight = "bold"
                                show_content.style.color = "black"
                                if (ddayResult < '4') {
                                    show_day.style.color = "red"
        
                                } else if (ddayResult < '8') {
                                    show_day.style.color = "blue"
                                } else {
                                    show_day.style.color = "black"
                                }
                            }
                            
                        </script>
                        </div>
                        <div class="d-day" id="d-day-plus"><span class="d-date" id="d-date-plus">+</span>디데이 추가하기</div>
                        <script>
                            var d_daylist = JSON.parse('<%- JSON.stringify(d_day) %>');
                            var invisible_plus=document.getElementById('d-day-plus');
                            if(d_daylist.length>=8){
                                
                                invisible_plus.style.display='none';
                            }else{
                                invisible_plus.style.display='inline-block';
                            }
                        </script>
                    </div>
                    
                    <div class="folder_">
                        
                        <div id="wrap_folder" class="wrap_folder">
                            <% for(var i=0;i<folder.length; i++) { %>
                                
                                <div class="folder">
                                    

                                <% if(folder[i].folder_fixed) {%>
                                    <img src=<%= folder[i].folder_color %> class='folder_img'/>
                                    <p class='main_folder_name' onclick="location.href='/folder/<%=folder[i]._id %>'"><%= folder[i].folder_name %></p>
                                    <img class="fixed_folder" src="/media/fixed_full.png" onclick="fixedFolderClicked('<%= i %>','<%= folder[i]._id%>', '<%= folder[i].folder_fixed%>')">
                                    <img class="three_button" src="/media/three_button.png">
                                    <ul class="folder_menu">
                                        <li><div id="revise_folder" class="revise_folder" onclick="reviseFolderClicked('<%= folder[i]._id %>','<%= i %>')">수정</div></li>
                                        <li><div id="delete_folder" class="delete_folder" onclick="deleteFolderClicked('<%= folder[i]._id%>','<%= i %>');">삭제</div></li>    
                                    </ul>
                                <!-- <div id="dropdown-folder" class="dropdown_folder">
                                    <button role="menuitem" class="dropdown_choice revise_folder" id="revise_folder" onclick="reviseFolderClicked('<%= i %>');"></button>
                                    <button role="menuitem" class="dropdown_choice delete_folder" id="delete_folder" onclick="reviseFolderClicked('<%= i %>');"></button></div> -->
                                    
                                <%} else{ %>
                                    <img src=<%= folder[i].folder_color %> class='folder_img'/>
                                    <p class='main_folder_name' onclick="location.href='/folder/<%=folder[i]._id %>'"><%= folder[i].folder_name %></p>
                                    <img class="fixed_folder" src="/media/fixed_empty.png" onclick="fixedFolderClicked('<%= i %>','<%= folder[i]._id%>', '<%= folder[i].folder_fixed%>')">
                                    <img class="three_button" src="/media/three_button.png">
                                    <ul class="folder_menu">
                                        <li><div id="revise_folder" class="reivse_folder" onclick="reviseFolderClicked('<%= folder[i]._id %>','<%= i %>')">수정</div></li>
                                        <li><div id="delete_folder" class="delete_folder" onclick="deleteFolderClicked('<%= folder[i]._id %>','<%= i %>');">삭제</div></li>    
                                    </ul>
                                    <!-- dialog로 보여줄 지 고민해보기 -->
                                <!-- <div id="dropdown-folder" class="dropdown_folder">
                                    <button role="menuitem" class="dropdown_choice" id="revise_folder" onclick="reviseFolderClicked('<%= i %>');"></button>
                                    <button role="menuitem" class="dropdown_choice" id="delete_folder" onclick="deleteFolderClicked('<%= i %>');"></button></div> -->
                                    <% } %>
                                
                                </div>


                                <% } %>
                            </div>

                            <!-- folder 수정하기 -->
                            <div id="modal" class="modal modal_revise_folder">
                                <div class="modal-content-revise-folder">
                                    <span class="close_button close_revise_folder">&times;</span>
                                    <h1 class="title">폴더 수정하기</h1>
                                    <div id="revise_folder_id" folder_id="id자리"></div>
                                        <div>
                                            <input type="text" id="new-folder-name" name="new_folder_name" maxlength="7">
                                            <div class="folder_color_wrap" value="폴더의 색을 선택하세요.">
                                                <select id="new_folder_color" name="new_folder_color">
                                                
                                                <option value='/public/media/folder_orange.svg' style="background-color: #f29b34;">주황색</option>
                                                <option value='/public/media/folder_green.svg' style='background-color: #97ce68;'>연두색</option>
                                                <option value='/public/media/folder_yellow.svg' style='background-color: #fcd341;'>노란색</option>
                                                <option value='/public/media/folder_red.svg' style='background-color: #e36363;'>다홍색</option>
                                                <option value='/public/media/folder_mint.svg' style='background-color: #4dbdc2;'>하늘색</option>
                        
                                            
                                                </select>
                                            </div>
                                            <p>※새로고침을 하여 수정된 폴더 정보를 확인할 수 있습니다.</p>
                                        <div>
                                            <input type="button" class="modal-folder-revise" value="확인"></input>
                                        </div>
                                        </div>
                                </div>
                            </div>

                            <!-- folder 삭제하기 -->
                            <div id="modal" class="modal modal_delete_folder">
                                <div class="modal-content-delete-folder">
                                    <!-- <h1 class="title">폴더 삭제하기</h1> -->
                                    <div id="delete_folder_name" class="title"></div>
                                        <div id="delete_folder_index"></div>
                                        
                                            
                                            
                                            <p>※폴더 내 포스트잇 정보도 삭제됩니다.
                                                그래도 삭제하시겠습니까?
                                            </p>
                                        <div class="buttons_wrap">
                                            
                                            <div data-dismiss="modal" class="btn cancelBtn cancel_delete_folder">취소</div>
                                            <div class="deleteBtn delete_delete_folder">확인</div>
                                        </div>
                                        
                                </div>
                            </div>

                            <script type='text/javascript'>
                            var fixed_toggle=1;
                            function fixedFolderClicked(index, id, fixedBool){
                                var fixed_img=document.getElementsByClassName('fixed_folder')[index];

                                var currentFixed=fixedBool;
                                console.log("현재의 상태는 "+currentFixed);

                                if(currentFixed==true){
                                    fixed_toggle++;
                                }

                                if(fixed_toggle%2==1){
                                    currentFixed=true;
                                    fixed_img.src="/media/fixed_full.png"
                                    fixed_img.style.opacity=1;

                                    fetch('/folder_fixed',{
                                        method:'PATCH',
                                        headers:{
                                            'Accept':'application/json',
                                            'Content-Type':'application/json'
                                        },
                                        body:JSON.stringify({folder_id:id,folder_fixed:true})
                                    });
                                    console.log("true로 변신!");
                                }else{
                                    currentFixed=false;
                                    fixed_img.src="/media/fixed_empty.png"
                                    fixed_img.style.opacity=1;

                                    fetch('/folder_fixed',{
                                        method:'PATCH',
                                        headers:{
                                            'Accept':'application/json',
                                            'Content-Type':'application/json'
                                        },
                                        body:JSON.stringify({folder_id:id,folder_fixed:false})
                                    });
                                    console.log("false로 변신!");
                                }
                                fixed_toggle++;
                            }
                                //var dropdown_toggle=1;
                            //function showFolderMenu(index){
                               // console.log(index);
                                // console.log(index);
                                // var new_index=parseInt(index);
                                // console.log(new_index);
                                //나중에 index로 받아서 처리하기
                                //var dropdownButton=document.getElementsByClassName('dropdown_folder')[index];
                                //document.getElementsByClassName('dropdown_folder')[index].style.display='block';
                                //var revise_button=document.getElementById('drop')[index];
                                //var delete_button=document.getElementById('delete_folder')[index];
                                //dropdownButton.style.display='block';
                            
                            //}

                            var modal_revise_folder=document.querySelector('.modal_revise_folder');
                            //var trigger_revise_folder=document.querySelector('#revise_folder');
                            var close_revise_folder=document.querySelector('.close_revise_folder');
                            var store_revise_folder=document.querySelector('.modal-folder-revise');

                            var modal_delete_folder=document.querySelector('.modal_delete_folder');
                            var cancel_delete_folder=document.querySelector('.cancel_delete_folder');
                            var delete_delete_folder=document.querySelector('.delete_delete_folder');
                            // function showReviseModal(name, color){ 
                                
                            //     toggleReviseFolderModal();

                                
                            //     var close_revise_folder=document.querySelector('.close_revise_folder');
                            //     var store_revise_folder=document.querySelector('.modal-folder-revise');
                                
                                
                            //     close_revise_folder.addEventListener('click',toggleReviseFolderModal);
                            //     store_revise_folder.addEventListener('click',toggleReviseFolderModal);
                            // }
                        
                        
                            function toggleReviseFolderModal(){
                                modal_revise_folder.classList.toggle("show_modal");
                            }
                            function toggleDeleteFolderModal(){
                                modal_delete_folder.classList.toggle('show_modal');
                            }
                            function windowOnClick(event){
                                if(event.target===modal_revise_folder){
                                    toggleReviseFolderModal();
                                }else if(event.target===modal_revise_folder){
                                    toggleDeleteFolderModal();
                                }
                            }
                            
                            
                            close_revise_folder.addEventListener('click',toggleReviseFolderModal);
                            store_revise_folder.addEventListener('click',toggleReviseFolderModal);

                            cancel_delete_folder.addEventListener('click',toggleDeleteFolderModal);
                            delete_delete_folder.addEventListener('click',toggleDeleteFolderModal);

                            function reviseFolderClicked(id, index){
                                var revise_folder=document.getElementsByClassName('folder')[index];
                                var revise_name=document.getElementsByClassName('main_folder_name')[index].innerHTML;
                                //$('input[name=new_folder_name]').attr('value',revise_name);
                                var revise_color=document.getElementsByClassName('folder_img')[index].getAttribute('src');
                                //$('#new_folder_color').val(revise_color).prop('selected',true);
                                //모달을 다시 보여줘서 폴더 수정하기를 해서 기존의 값을 넣게 만들기.
                                //기존의 값이 selec
                                
                                document.getElementById('new-folder-name').setAttribute('value',revise_name);
                                var hidden_id=document.getElementById('revise_folder_id');
                                hidden_id.setAttribute('folder_id',id);
                                
                                $('#new_folder_color').val(revise_color).prop('selected',true);
                                toggleReviseFolderModal();
                                
                            }

                        store_revise_folder.addEventListener('click',function(){
                                    var id=document.getElementById('revise_folder_id').getAttribute('folder_id');
                                    var revise_folder_name=$('#new-folder-name').val();

                                    var revise_folder_color=$('#new_folder_color:selected').val();

                                    if(revise_folder_name.trim()==''){
                                        alert("수정할 이름을 입력하세요");
                                    }else{
                                        fetch('/folder_revise',{
                                            method:'PATCH',
                                            headers:{
                                                'Accept':'application/json',
                                                'Content-Type':'application/json'
                                                },
                                            body:JSON.stringify({folder_id:id, revise_folder_name:revise_folder_name, revise_folder_color:revise_folder_color})
                                            });                                       
                                        }
                            });

                            function deleteFolderClicked(id,index){
                                
                                var delete_folder=document.getElementsByClassName('folder')[index];
                                var delete_folder_name=document.getElementsByClassName('main_folder_name')[index].innerHTML;
                                //console.log(delete_folder_name, index);
                                document.getElementById('delete_folder_name').innerHTML=delete_folder_name+" 삭제하기"
                                document.getElementById('delete_folder_name').setAttribute('value',delete_folder_name);
                                document.getElementById('delete_folder_index').setAttribute('value',index);
                                toggleDeleteFolderModal();

                        }

                        delete_delete_folder.addEventListener('click',function(){
                            var parent=document.getElementById('wrap_folder'); 
                            var delete_folder_name=document.getElementById('delete_folder_name').getAttribute('value');
                            var index=document.getElementById('delete_folder_index').getAttribute('value');
                            var delete_folder=document.getElementsByClassName('folder')[index];
                            console.log(delete_folder_name,index);
                            fetch('/folder',{
                                    method:'DELETE',
                                    headers:{
                                            'Accept':'application/json',
                                            'Content-Type':'application/json'
                                        },
                                        body:JSON.stringify({user_id:'<%= user.name %>',folder_name:delete_folder_name})
                                        //.then(res => res.json())   
                                    });
                                    parent.removeChild(delete_folder);
                        });
                        
                                
                            </script> 
                            
                            <!-- <div id="folder_0" class="folder">
                                <img src="media/plus_folder_yellow.png" class="folder_img"/>
                                <img src="media/fixed_empty.png" class="fixed" onclick="fixedClicked(0)" />
                                <p class="main_folder_name">알고리즘</p>
                                <img class="folder_button" src="media/three_button.png" onclick="showFolderMenu(0);">
                                <div id="dropdown-folder0" class="dropdown_folder">
                                <button role="menuitem" class="dropdown_choice" id="revise_folder0" onclick="reviseFolderClicked(0);"></button>
                                <button role="menuitem" class="dropdown_choice" id="delete_folder0" onclick="deleteFolderClicked(0);"></button>
                                </div>
                        </div>
                        -->
                        <!-- </div> -->


                        <div id="folder_plus">
                            <img src="media/plus_folder_gray.png"/><p>추가하기</p>
                        </div>
                            <!-- <script>
                                var username = localStorage.getItem('username');
                                activeUser = getActiveUser(username);
        
                                function newFolder() {
                                    var new_name = prompt("폴더 이름을 입력하세요", "");
                                    var new_div = document.createElement('div');
                                    var origin_div = document.getElementById('wrap_folder');
                                    //append로 안함
                                    var before_div = document.getElementById('folder_1');
        
                                    //별 넣기
                                    new_star = document.createElement('img');
                                    new_star.setAttribute('id', 'new_star');
                                    new_star.src = "media/empty_star.png"
                                    new_star.style.float = "left";
                                    new_star.style.margin = "5px";
                                    new_star.style.width = "25px";
                                    new_star.style.height = "auto";
                                    new_star.style.dispaly = "inline";
                                    new_star.setAttribute('onclick', "newClicked();")
        
                                    var new_p = document.createElement('p');
                                    new_p.innerHTML = new_name;
                                    new_p.setAttribute("onclick", "toNextPage(" + 6 + ")")
                                    new_div.setAttribute('class', 'new_div');
                                    new_div.append(new_star);
                                    new_div.append(new_p);
        
                                    origin_div.insertBefore(new_div, before_div);
        
                                    var new_folder = {
                                        title: new_p.innerHTML,
                                        star: "false",
                                        postIt: []
        
                                    }
                                    activeUser.folder.push(new_folder);
        
                                    console.info(activeUser.folder)
                                }
                            </script> -->

                </div>
            </div>
            </div>
            <div id="MAIN_RIGHT" class="column_right">
                <div class="aside">
                    <!-- 여기는 aisde(우측 로그인, 오늘할일) -->
                    <div class="aside_wrap">
                        <p>오늘 할 일</p>
                        
                        <div class="todaylist" id="todaylist">
                            
                            
                            <div class="todaylists" id='todaylists'>
                                <!-- todolist 뿌려주기 -->
                                
                            <% for(var i=0;i<todolist.length; i++) { %>
                            
                                <input type="hidden" value="<%=todolist[i].todo_content%>" class="todolist-id"/>
                                <% if(todolist[i].todo_finished) {%>
                                    <div class='wrap_label'><label class='label'><input type="checkbox" checked name='checkbox' onclick="onCheckedHandler('<%= todolist[i].todo_content %>',true)" class="checkbox">
                                        <p style='text-decoration: line-through;' class="p_p"><%= todolist[i].todo_content %></p></label><span class='delete_todo' onclick="onDeleteTodo('<%= todolist[i].todo_content %>','<%= i %>')">&times;</span></div>
                                <%} else{ %>
                                    <div class='wrap_label'><label class='label'><input type="checkbox" name='checkbox' onclick="onCheckedHandler('<%= todolist[i].todo_content %>',false)" class="checkbox">
                                        <p style='text-decoration: none;'class="p_p"><%= todolist[i].todo_content %></p></label><span class='delete_todo' onclick="onDeleteTodo('<%= todolist[i].todo_content %>','<%= i %>')">&times;</span></div>
                                    <% } %>
                                <% } %>
                                <!-- </form> -->
                                <!-- if문을 통해서 해당 todolist[i].todo_finished값이 true라면 checkbox에 checked로 띄워지게! -->
                            </div>
                            <input type="submit" class="btnplusTodo" value="+   할 일 추가하기"></input>
                        </div>
                        
                        <script>
                        
                            var checked_toggle=1;
                            //모달에서 추가하기를 눌렀을 때 값이 다시 업데이트가 되도록 mongodb에서 값 가져오기..
                            function onCheckedHandler(todo_content, boolValue){ //해당 _id값이 넘어온 것이니까 //mongodb에서 수정하기 위해서
                                var checkedIndex;
                                var checkedBox=document.getElementsByClassName('checkbox');
                                var hidden_input=document.getElementsByClassName('todolist-id');
                                for(var i=0;i<hidden_input.length;i++){
                                    if(hidden_input[i].value==todo_content){
                                        checkedIndex=i;
                                    }
                                }
                                var currentState=boolValue;
                                //console.log(currentState+'->'+!(currentState));
                                if(currentState==true){
                                    checked_toggle++;
                                }
                                var content=document.getElementsByClassName('p_p');
                                if(checked_toggle%2==1){ //unchecked -> checked
                                    content[checkedIndex].style.textDecoration='line-through';
                                    currentState=true;
                                    
                                    fetch('/',{
                                        method:'PATCH',
                                        headers:{
                                            'Accept':'application/json',
                                            'Content-Type':'application/json'
                                        },
                                        body:JSON.stringify({user_id:'<%= user.name %>',todo_content:content[checkedIndex].innerHTML, todo_finished:true})
                                        //.then(res => res.json( ))  
                                    });
                                    
                                }else{   //checked -> unchecked
                                    content[checkedIndex].style.textDecoration='none';
                                    content[checkedIndex].setAttribute('checked',false);
                                    
                                    currentState=false;
                                    fetch('/',{
                                        method:'PATCH',
                                        headers:{
                                            'Accept':'application/json',
                                            'Content-Type':'application/json'
                                        },
                                        body:JSON.stringify({user_id:'<%= user.name %>',todo_content:content[checkedIndex].innerHTML, todo_finished:false})
                                        //.then(res => res.json())  
                                    });

                                }      
                                    checked_toggle++;
                                                       }
                            
                            function onDeleteTodo(todo_content,delete_index){
                                var parent=document.getElementById('todaylists');
                                
                                var delete_div=document.getElementsByClassName('wrap_label')[delete_index];
                                //console.log(delete_index);
                            
                                //db에 삭제되도록 하기
                                fetch('/',{
                                        method:'DELETE',
                                        headers:{
                                            'Accept':'application/json',
                                            'Content-Type':'application/json'
                                        },
                                        body:JSON.stringify({user_id:'<%= user.name %>',todo_content:todo_content})
                                        //.then(res => res.json())   
                                    });
                                    parent.removeChild(delete_div);
                                    alert(todo_content+'이(가) 오늘 할 일에서 삭제되었습니다.');
                            }
                        
                        </script>

                        
                        <!--+부분 이미지로 넣기-->
                        
                        <div class="caution">
                            오늘(11:59 PM)기준으로 완료된 할 일은<br>내일(12:00 AM)기준으로 제거되고,<br>완료되지 않은 할 일은 유지됩니다.
                        </div>
                </div>
            </div>

        <!-- todo-list 추가하기 모달 팝업 -->
    <div id="modal" class="modal modal_todo">
        <div class="modal-content-todo">
        <span class="close_button close_todo_button">&times;</span>
        <h1 class="title">오늘 할 일 추가히기</h1>
        <!-- <form action='/' method="POST"> -->
            <div>
                <input type="text" id="modal-todo" name="todo_content" maxlength="10" placeholder="할 일을 작성해보세요.">
                <input type="hidden">
            </div>
            <div>
                <input type="button" class="modal-todo-plus" value="확인"></input>
            </div>
        <!-- </form> -->
        </div>
    </div>
        <!-- d-day 추가하기 모달 팝업 -->
    <div id="modal" class="modal modal_day">
        <div class="modal-content-day">
        <span class="close_button close_day_button">&times;</span>
        <h1 class="title">디데이 추가하기</h1>
        <!-- <form action="#post.js" method="POST"> -->
            <div class="plus-part">
                <!-- 추가할 때의 부분 -->
                
                <div><input type="date" id="modal-d-date" class="d-date" value="날짜"></input>
                <!-- <script> $(document).ready(function() {
                    $("#modal-d-date").datepicker(); });
                    </script> -->
                <!-- <input type="text" id="d-date" class="d-date" placeholder="날짜"> -->
                <input type="text" id="modal-d-content" class="d-content" placeholder="내용 (최대 7자)"></div>
                <!-- <input type="button" id="d-date" class="d-date" onclick="sayPrompt()" value="날짜"></input> -->
                <!-- <input type="button" id="d-content"class="d-content" onclick="sayPrompt()" value="내용"></input> -->
                <!-- 버튼을 클릭하면 edittext로 만드는 방법 고민해보기 일단 이렇게 했다-->
                <div><input type="button" class="modal-d-plus" value="디데이 추가"></input></div>
            </div> 
        <!-- </form> -->
        </div>
    </div>

<!-- folder 추가하기 -->
    <div id="modal" class="modal modal_folder">
        <div class="modal-content-folder">
            <span class="close_button close_folder_button">&times;</span>
            <h1 class="title">폴더 추가하기</h1>
                <div>
                    <input type="text" id="modal-folder-name" name="folder_name" maxlength="7" placeholder="폴더 이름을 입력하세요.">
                    <div class="folder_color_wrap" value="폴더의 색을 선택하세요.">
                        <select id="folder_color" name="folder_color">
                        <!-- <option value='#f29b34' selected><input type='color' value=' #f29b34'></option>
                        <option value='#97ce68'><input type='color' value='#97ce68'></option>
                        <option value='#fcd341'><input type='color' value='#fcd341'></option>
                        <option value='#e36363'><input type='color' value='#e36363'></option>
                        <option value='#4dbdc2'><input type='color' value='#4dbdc2'></option> -->
                        
                        <option value='/public/media/folder_orange.svg' style="background-color: #f29b34;">주황색</option>
                        <option value='/public/media/folder_green.svg' style='background-color: #97ce68;'>연두색</option>
                        <option value='/public/media/folder_yellow.svg' style='background-color: #fcd341;'>노란색</option>
                        <option value='/public/media/folder_red.svg' style='background-color: #e36363;'>다홍색</option>
                        <option value='/public/media/folder_mint.svg' style='background-color: #4dbdc2;'>하늘색</option>

                    
                        </select>
                    </div>
                <div>
                    <input type="button" class="modal-folder-plus" value="확인"></input>
                </div>
                </div>
        </div>
    </div>



    <script type='text/javascript'>
    var modal_todo=document.querySelector(".modal_todo");
    var modal_day = document.querySelector(".modal_day"); // 팝업 될 레이어 class명
    var modal_folder=document.querySelector('.modal_folder')
    var trigger_todo=document.querySelector(".btnplusTodo"); //todo 추가하기 버튼
    var trigger_day = document.querySelector("#d-day-plus"); // 새로운 d-day 추가하기 버튼
    var trigger_folder=document.querySelector('#folder_plus');
    var closeTodoButton=document.querySelector('.close_todo_button');
    var closeDayButton = document.querySelector(".close_day_button");  // 우측 상단 닫기 버튼
    var closeFolderButton=document.querySelector('.close_folder_button');
    var storeTodoButton=document.querySelector('.modal-todo-plus');
    // var storeDayButton=document.querySelector('.modal-d-plus');
    var storeFolderButton=document.querySelector('.modal-folder-plus');

    function toggleDayModal() {
        modal_day.classList.toggle("show_modal");
    }
    function toggleTodoModal(){
        modal_todo.classList.toggle("show_modal");
    }
    function toggleFolderModal(){
        modal_folder.classList.toggle('show_modal');
    }

    function windowOnClick(event) {
        if (event.target === modal_day) {
            toggleDayModal();
        }else if(event.target===modal_todo){
            toggleTodoModal();
        }
        else if(event.target===modal_folder){
            toggleFolderModal();
        }
    }
    trigger_day.addEventListener("click", toggleDayModal); // 디데이 추가하기 버튼
    trigger_todo.addEventListener("click",toggleTodoModal);
    trigger_folder.addEventListener('click',toggleFolderModal);
    closeDayButton.addEventListener("click", toggleDayModal);
    closeTodoButton.addEventListener('click',toggleTodoModal);
    closeFolderButton.addEventListener('click',toggleFolderModal);
    // storeDayButton.addEventListener('click',toggleDayModal);
    storeTodoButton.addEventListener('click',toggleTodoModal);
    storeFolderButton.addEventListener('click',toggleFolderModal);
    //window.addEventListener("click", windowOnClick);

    $('.modal-todo-plus').click(function(event){
        var new_content=$('#modal-todo').val();
        //var new_todo_id=todolist._id;
        if(new_content.trim()===''){ //내용을 입력하지 않은 경우
            alert("내용을 입력해주세요.");}
        else{
            var new_todolist;
            $.ajax({
                type:'POST',
                async:true,
                url:'/todo',
                data:{
                    todo_content:new_content,
                    todo_finished:false
                },
        
                success:function(data){
                    var new_todo = {
                        todo_content : new_content,
                        todo_finished : false
                    }
                    addNewTodo(new_todo);
                
                },error:function(err){
                    console.log('todo 저장 실패');
                }
            });

            // 디데이 개수 체크
            var parent_day=document.getElementById('wrap_day');
            var childCnt = parent_day.childElementCount;
            console.log('자식 개수:'+childCnt);
            //var invisible_plus=document.getElementById('d-day-plus');
            if (childCnt > 9 && ($('#d-day-plus').css('display') == 'inline-block')) { // <script>2개, d-day 8개 => 총 10개
                $('#d-day-plus').css('display', 'none');
                //invisible_plus.style.display='none';
            } else if (childCnt == 9 && ($('#d-day-plus').css('display') == 'none')) {
                $('#d-day-plus').css('display', 'none');
            } else {
                $('#d-day-plus').css('display', 'inline-block');
                //invisible_plus.style.display='inline-block';
            }
        }
    })
    
    function addNewTodo(todolist){
    
        var content=todolist.todo_content;

        var parent_todolist=document.getElementById('todaylists');
        
        var new_div=document.createElement('div');
        new_div.setAttribute('class','wrap_label');
        var new_input=document.createElement('input');
        new_input.setAttribute('type','hidden');
        new_input.setAttribute('value',content);
        new_input.setAttribute('class','todolist-id')
        var new_label=document.createElement('label');
        new_label.setAttribute('class','label');
        var new_checkbox=document.createElement('input');
        new_checkbox.setAttribute('type','checkbox');
        new_checkbox.setAttribute('name','checkbox');
        new_checkbox.setAttribute('class','class');
        //new_checkbox.setAttribute('onclick','onCheckedHandler('+content+','+false+')')
        // 이 값을 함수 호출하는 곳에서 가져와야 함...
        var new_p=document.createElement('p');
        new_p.setAttribute('class','p_p');
        new_p.innerHTML=content;
        var new_span=document.createElement('span');
        new_span.setAttribute('class','delete_todo');
        //new_span.setAttribute('onclick','onDeleteTodo('+content+')')
        
        var new_ck_toggle=1;
        new_checkbox.addEventListener('click',function(){
            
            var check_content=todolist.todo_content;
            //console.log(check_content);
            var check_value=todolist.todo_finished;
            //onCheckedHandler(content,check_value);
            //console.log(check_value+'->'+!(check_value));
            if(check_value==true){
                new_ck_toggle++;
            }
            if(new_ck_toggle%2==1){
                new_p.style.textDecoration='line-through';
                check_value=true;

                fetch('/',{
                    method:'PATCH',
                    headers:{
                    'Accept':'application/json',
                    'Content-Type':'application/json'
                },
                body:JSON.stringify({user_id:'<%= user.name %>',todo_content:new_p.innerHTML, todo_finished:true})
                //.then(res => res.json( ))  
                });
            }else{
                new_p.style.textDecoration='none';
                check_value=false;
                fetch('/',{
                    method:'PATCH',
                    headers:{
                        'Accept':'application/json',
                        'Content-Type':'application/json'
                        },
                    body:JSON.stringify({user_id:'<%= user.name %>',todo_content:new_p.innerHTML, todo_finished:false})
                    //.then(res => res.json())  
                    });
            }
            new_ck_toggle++;
        });

        new_span.innerHTML='&times;'

        parent_todolist.append(new_div);
        new_div.append(new_label);
        new_label.append(new_checkbox);
        new_label.append(new_p);
        new_div.append(new_span);

        new_span.addEventListener('click',function(){
            //삭제했을 때 바뀌도록 ... delete함수 사용
            fetch('/',{
                method:'DELETE',
                headers:{
                    'Accept':'application/json',
                    'Content-Type':'application/json'
                    },
                body:JSON.stringify({user_id:'<%= user.name %>',todo_content:new_p.innerHTML})
                //.then(res => res.json())   
                });
                alert(new_p.innerHTML+'이(가) 오늘 할 일에서 삭제되었습니다.');
                parent_todolist.removeChild(new_div);
        });
    }

    $('.modal-folder-plus').click(function(event){
        //추가되면 mongodb에 저장되도록
        var new_folder_name=$('#modal-folder-name').val();
        var new_folder_color=$('#folder_color option:selected').val(); //폴더 색 위치
        //console.log(new_folder_color);
        if(new_folder_name.trim()===''){
            alert('폴더 이름을 입력하세요');
        }else{
            $.ajax({
                type:'POST',
                async:true,
                url:'/folder_add',
                data:{
                    folder_name:new_folder_name,
                    folder_color:new_folder_color
                },
                success:function(data){
                    var new_folder={
                        folder_name: new_folder_name,
                        folder_fixed:false
                    }
                    //console.log(new_folder_color);
                    //console.log(data.folder_id);
                    var new_folder_id=data.folder_id;
                    addNewFolder(new_folder,new_folder_id,new_folder_color);
                    

                    //동적 추가 시 피룡함
                },error:function(err){
                    console.log('folder 추가 실패');
                }
            })
        }
    });

    function addNewFolder(folder,folder_id,folder_color){
        
        //console.log(folder_color);
        var name=folder.folder_name;
        var color;
        var fixed=folder.folder_fixed;
        console.log("fixed의 값은 "+fixed);
        //console.log(JSON.stringify(color));

        //console.log(JSON.stringify(color));
        //console.log(name, color, fixed);
        
        var wrap=document.createElement('div');
        wrap.setAttribute('class','folder');

        var parent_folder=document.getElementById('wrap_folder');


        var img_folder=document.createElement('img');
        img_folder.setAttribute('src',folder_color); //이거 때문에 계속 get 404에러가 난다! 이거를 그냥 if문을 사용해서 src에 넣어야겠다
        //console.log(img_folder.getAttribute('src'));
        img_folder.setAttribute('class','folder_img');
        var p=document.createElement('p');
        p.setAttribute('class','main_folder_name');
        p.innerHTML=name;
        p.addEventListener('click',function(){
            location.href='/folder/'+folder_id;
        });

        var fixed_img=document.createElement('img');
        fixed_img.setAttribute('class','fixed_folder');
        fixed_img.setAttribute('src','/media/fixed_empty.png');
        
        new_fixed_toggle=1;
        fixed_img.addEventListener('click',function(){
            if(fixed==true){
                new_fixed_toggle++;
            }

            if(new_fixed_toggle%2==1){
                folder.fixed=true;
                fixed_img.setAttribute('value',true);
                fixed_img.setAttribute('src','/media/fixed_full.png');
                fixed_img.style.opacity=1;
                fetch('/folder_fixed',{
                    method:'PATCH',
                    headers:{
                        'Accept':'application/json',
                        'Content-Type':'application/json'
                    },
                    body:JSON.stringify({folder_id:folder_id,folder_fixed:true})
                        });
                
            }else{
                fixed=false;
                folder.fixed=false;
                fixed_img.setAttribute('src','/media/fixed_empty.png');
                fetch('/folder_fixed',{
                    method:'PATCH',
                    headers:{
                        'Accept':'application/json',
                        'Content-Type':'application/json'
                    },
                    body:JSON.stringify({folder_id:folder_id,folder_fixed:false})
                        });
                
            }
            new_fixed_toggle++;

            
        })
        var img_button=document.createElement('img');
        img_button.setAttribute('class','three_button');
        img_button.setAttribute('src','/media/three_button.png');
        
        var ul_menu=document.createElement('ul');
        ul_menu.setAttribute('class','folder_menu');
        var li_1=document.createElement('li');
        var li_re=document.createElement('div');
        li_re.addEventListener('click',function(){
            document.getElementById('new-folder-name').setAttribute('value',name);
            $('#new_folder_color').val(folder_color).prop('selected',true);
                toggleReviseFolderModal();
        })
        li_re.setAttribute('id','revise_folder');
        li_re.innerHTML='수정';
        var li_2=document.createElement('li');
        var li_del=document.createElement('div');
        li_del.innerHTML="삭제";
        li_del.setAttribute('id','delete_folder');
        
        
        li_1.append(li_re);
        li_2.append(li_del);
        ul_menu.append(li_1);
        ul_menu.append(li_2);

        wrap.append(img_folder);
        wrap.append(p);
        wrap.append(fixed_img);
        wrap.append(img_button);
        wrap.append(ul_menu);

            parent_folder.append(wrap);

            li_del.addEventListener('click',function(){
            if(confirm('정말 삭제하시겠습니까?')==true){
            //동적 삭제
            fetch('/folder',{
                method:'DELETE',
                headers:{
                    'Accept':'application/json',
                    'Content-Type':'application/json'
                    },
                body:JSON.stringify({user_id:'<%= user.name %>',folder_name:p.innerHTML})
                //.then(res => res.json())   
                });
                parent_folder.removeChild(wrap);
            }else{
                alert(p.innerHTML+'이(가) 삭제를 취소합니다.')
            }
        }); 
    }

    // 디데이 동적으로 추가
    function newDeleteDay(content){
        var parent_day=document.getElementById('D-day');
        var delete_day=document.getElementsByClassName('d-day');

        //DB에서 삭제되도록
        fetch('/day',{
            method:'DELETE',
            headers:{
                'Accept':'application/json',
                'Content-Type':'application/json'
                    },
            body:JSON.stringify({user_id:'<%= user.name %>',dday_content:content})
            //.then(res => res.json())   
                    });
            parent_day.removeChild(delete_day);
            alert(content+'이(가) d-day에서 삭제되었습니다.');
    }

    $(document).ready(function () {

        $('.modal-d-plus').bind('click', function() {
            saveDday(this);
        });

        var saveDday = function(event) { // 디데이 저장하기 버튼
            $('.modal-d-plus').unbind('click');

            var date = $('#modal-d-date').val();
            var content = $('#modal-d-content').val();
            console.log('날짜: ',date);
            console.log('내용: ',content);
            
            // 오늘 날짜
            var today = new Date();
            var curyear = today.getFullYear();
            var curmon = today.getMonth()+1;
            if (curmon < 10) {
                curmon = '0'+curmon;
            }
            var curdate = today.getDate();
            var todayDate = curyear+'-'+curmon+'-'+curdate;
            console.log('오늘:', todayDate);

            if (date.trim() === '') {
                alert('디데이 마감 날짜를 선택해주세요.');
                $('.modal-d-plus').bind('click', function() { saveDday(this); });
            } else if (content.trim() === '') {
                alert('디데이 내용을 입력해주세요.');
                $('.modal-d-plus').bind('click', function() { saveDday(this); });
            } else if (new Date(date) < new Date(todayDate)) { // 오늘 날짜 이전이면 에러 처리
                alert('디데이 날짜는 금일('+todayDate+') 보다 이전일 수 없습니다.');
                $('.modal-d-plus').bind('click', function() { saveDday(this); });
            } else { // 저장하기
                $.ajax({
                    type:"POST",
                    async : true,
                    url:'/d-day',
                    data : {
                        date : date,
                        content : content,
                        today : todayDate,
                    },
                    success:function(data){ // POST요청 성공한 경우
                        
                        // 버튼 더이상 클릭되지 않게 하기
                        $('.modal-d-plus').bind('click', function() {
                            saveDday(this);
                        });
                        // 입력된 정보들 지우기
                        $('#modal-d-date').val('');
                        $('#modal-d-content').val('');


                        toggleDayModal(); // 모달 닫기

                        // 동적으로 추가
                        // in here d-day-plus
                        var show_day = document.createElement("div");
                        var show_content = document.createElement("span");
                        show_day.setAttribute("class", "d-day")
                        show_content.setAttribute("class", "d-date")
                        var tmp = d_daylist[i]; //해당 나온 날짜와 내용을 tmp에 넣음
                        show_content.innerHTML = content;

                        var delete_day=document.createElement('span');
                        delete_day.setAttribute('class','delete_day');
                                
                        delete_day.innerHTML= '&times;';
                        
                        // 디데이 계산하기
                        var date1 = new Date(today);
                        var date2 = new Date(date);
                        var gap = date2.getTime() - date1.getTime();
                        var ddayResult = Math.ceil(gap/(1000*60*60*24));

                        show_day.innerHTML="D-"+ddayResult

                        show_day.append(delete_day);
                        show_day.appendChild(show_content);
                        parentDiv.prepend(show_day);
                        delete_day.addEventListener('click',function(){
                            //DB에서 삭제되도록
                            fetch('/day',{
                                method:'DELETE',
                                headers:{
                                    'Accept':'application/json',
                                    'Content-Type':'application/json'
                                        },
                                body:JSON.stringify({user_id:'<%= user.name %>',dday_content:content})
                                //.then(res => res.json())   
                                        });
                            parentDiv.removeChild(show_day);
                            alert(content+'이(가) d-day에서 삭제되었습니다.');          
                        });

                        show_day.style.fontWeight = "bold"
                        show_content.style.color = "black"
                        if (ddayResult < '4') {
                            show_day.style.color = "red"

                        } else if (ddayResult < '8') {
                            show_day.style.color = "blue"
                        } else {
                            show_day.style.color = "black"
                        }

                        // 디데이 개수 체크
                        var parent_day=document.getElementById('wrap_day');
                        var childCnt = parent_day.childElementCount;
                        console.log('자식 개수2:'+childCnt);
                        //var invisible_plus=document.getElementById('d-day-plus');
                        if (childCnt > 9 && ($('#d-day-plus').css('display') == 'inline-block')) { // <script>2개, d-day 8개 => 총 10개
                            $('#d-day-plus').css('display', 'none');
                            //invisible_plus.style.display='none';
                        } else if (childCnt == 9 && ($('#d-day-plus').css('display') == 'none')) {
                            $('#d-day-plus').css('display', 'none');
                        } else {
                            $('#d-day-plus').css('display', 'inline-block');
                            //invisible_plus.style.display='inline-block';
                        }
                    },
                    error: function(err) { // POST 요청 실패시
                        console.log('디데이 추가 실패' + err);
                        alert('디데이 추가를 실패했습니다. 다시 시도해주세요.');
                        toggleDayModal(); 
                    }
                });
                
                
            }


        };

    });
    
    </script>
    </div>

    </div>
</body>

</html>