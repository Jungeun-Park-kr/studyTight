<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.5/jquery.min.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/jquery-ui.min.js"></script> 

    <title>회원가입</title>
    
    <style>
        @import url(/font.css);
        @import url(/login/login.css);
        @import url(/login/register_agree.css);
        @import url(/login/register.css);
        @import url(/login/register_modal.css);
    </style>
    <!-- <script src="/user/users.js"></script>
    <script src="/login/register.js"></script>
    <script src="/login/login.js"></script> -->
    
</head>
<body>
    <div id="warp">
        <div class="register_header"> 
            <!-- 여기는 왼쪽 메뉴 (로고) -->
            <div class ="logo_area"> 
                <img src="/public/media/logo_big.png" onclick="location.href='/'">
            </div>
        </div>
        <div id="container" role="main">
            <div class="section">
                <!-- 여기는 본문 들어갈 메인 섹션 -->
                
                <div class="join_section">
                    <!-- <form id="join_form" method="POST"> -->
                    <form id="join_form">
                        <div class="join_content">
                            <!-- 이메일 영역 -->
                            <div class="join_row join_email" id="emilDiv">
                                <div class="join_label">이메일</div>
                                <div class="email_verify_area">
                                
                                        <span class="join_form">
                                            <input type="email" id="email" name="email" placeholder="이메일 입력" maxlength="30" required autofocus/>
                                        </span>

                                        <a  class="btn_verify btn_primary" id="btn_email_send" role='button'>
                                            <span class="send_verify">인증번호 받기</span>
                                        </a>
                                        <script>
                                            // const send_verify_btn = document.querySelector('send_verify');
                                            // $.post('/email', function(data){
                                            //     console.log(data);
                                            // });
                                        </script>
                                    
                                </div>
                                <!-- 인증번호 입력 영역 -->
                                <div class="email_verify_area">
                                    
                                    <span class="join_form" >
                                        <input type="tel" id="email_verify" name="email_verify" placeholder="인증번호 입력" maxlength="6" disabled='true'/>
                                    </span>
                                    <a href="#" class="btn_verify btn_primary" id="btn_email_verify" role="button">
                                        <span class="chk_verify">인증번호 확인</span>
                                    </a>
                                </div>
                                <div class="verify_fail_info">인증번호를 받지 못하셨나요?</div>
                            </div>
                            <!-- 비밀번호 영역 -->
                            <div class="join_row join_pw" id="pwDiv">
                                <div class="join_label">비밀번호</div>
                                <div class="pw_input_area">
                                    <span class="join_form">
                                        <input type="password" id="password" name="password" placeholder="비밀번호 (6자리 ~ 32자리)" maxlength="32" />
                                    </span>
                                </div>
                                <div class="pw_verify_area">
                                    <span class="join_form">
                                        <input type="password" id="password_verify" name="password_verify" placeholder="비밀번호 재확인" maxlength="32" />
                                    </span>

                                    <a href="#" class="btn_verify btn_primary" id="btnPassVerify" role="button">
                                        <span class="">비밀번호 확인</span>
                                    </a>
                                </div>
                                
                            </div>

                            <!--  개인정보 입력 영역  -->
                            <!-- 이름 영역 -->
                            <div class="join_row join_name" id="infoDiv">
                                <div class="join_label">이름</div>
                                <div class="name_input_area">
                                    <span class="join_form">
                                        <input type="text" id="name" name="name" title="이름" class="int" placeholder="타인에게 공개될 내 이름 입력" maxlength="40" >
                                    </span>
                                </div>
                            </div>
                            
                            <!-- 성별 영역 -->
                            <div class="join_row join_gender" id="genderDiv">
                                <div class="join_label">성별</div>
                                <div class="gender_input_area">
                                    <div class="gender_code">
                                        <select id="gender" name="gender" class="sel">
                                            <option value selected>성별</option>
                                            <option value="M">남자</option>
                                            <option value="F">여자</option>
                                            <option value="U">선택 안함</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <div class="join_row join_birth" id="birthDiv">
                                <!-- 생년월일 영역 -->
                                <div class="join_label">생년월일</div>
                                <div class="bir_wrap">
                                    <div class="bir_yy">
                                        <span class="join_form">
                                            <input type="text" id="yy" placeholder="년(4자)" aria-label="년(4자)" class="int" maxlength="4">
                                        </span>
                                    </div>
                                    <div class="bir_mm">
                                        <div class="month_code">
                                            <select id="mm" class="sel" aria-label="월">
                                                <option value="">월</option>
                                                                <option value="01">
                                                                    1
                                                                </option>
                                                                <option value="02">
                                                                    2
                                                                </option>
                                                                <option value="03">
                                                                    3
                                                                </option>
                                                                <option value="04">
                                                                    4
                                                                </option>
                                                                <option value="05">
                                                                    5
                                                                </option>
                                                                <option value="06">
                                                                    6
                                                                </option>
                                                                <option value="07">
                                                                    7
                                                                </option>
                                                                <option value="08">
                                                                    8
                                                                </option>
                                                                <option value="09">
                                                                    9
                                                                </option>
                                                                <option value="10">
                                                                    10
                                                                </option>
                                                                <option value="11">
                                                                    11
                                                                </option>
                                                                <option value="12">
                                                                    12
                                                                </option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="bir_dd">
                                        <span class="join_form">
                                            <input type="text" id="dd" placeholder="일" aria-label="일" class="int" maxlength="2">
                                            <label for="dd" class="lbl"></label>
                                        </span>
                                    </div>
                                </div>
                            </div>

                            <!-- 가입하기 버튼 -->
                            <div class="btn_area">
                                <button id="btnJoin" class="btn_type btn_primary" formaction="/signup" ><span class="register">가입하기</span></button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        
        </div>


        <!-- 팝업 될 레이어 -->
        <div id="modal" class="modal modal_fail">
            <div class="modal-content">
                <span class="close_button close_fail_button">&times;</span>
                <h1 class="title">인증번호를 받지 못하셨나요?</h1>

                <!-- 내용 띄울 부분 -->
                <div class="content">이메일이 정확한지 확인해주세요. 
                    현재 사용중인 네이버, 구글, 다음(카카오)등의 메일이 맞나요?
                    사이트에 따라 인증번호 발송이 늦어질 수 있습니다.
                    계속해서 메일이 오지 않으면, 다시 인증번호를 요청해주세요.</div>

                <!-- 확인 버튼 -->
                <input type="button" id="confirm_fail" class="btn_confirm" value="확인"> 
            </div>
        </div>
        <div id="modal" class="modal modal_send">
            <div class="modal-content-small">
                <span class="close_button close_send_button">&times;</span>
                <h1 class="title">인증번호 발신 성공</h1>

                <!-- 내용 띄울 부분 -->
                <div class="content">입력한 이메일 계정에 접속하여
                    메일에 있는 인증번호를 입력 후,
                    인증번호 확인을 해주세요.</div>

                <!-- 확인 버튼 -->
                <input type="button" id="confirm_send" class="btn_confirm" value="확인" > 
                
                
            </div>
        </div>
        <div id="modal" class="modal modal_check">
            <div class="modal-content-small">
                <span class="close_button close_check_button">&times;</span>
                <h1 class="title">인증번호 확인 성공</h1>

                <!-- 내용 띄울 부분 -->
                <div class="content">이메일을 꼭 기억해주세요.
                    분실시 찾을 수 없으며,
                    비밀번호 찾기에 이용됩니다.
                    계속해서 나머지 정보를 입력해주세요.</div>

                <!-- 확인 버튼 -->
                <input type="button" id="confirm_check" class="btn_confirm" value="확인"> 
            </div>
        </div>
        <div id="modal" class="modal modal_register">
            <div class="modal-content-small">
                <span class="close_button close_register_button">&times;</span>
                <h1 class="title">회원가입 완료</h1>
                <!-- 내용 띄울 부분 -->
                <div class="content">회원가입을 축하드립니다!
                    이제 study Tight 서비스를 
                    이용할 수 있습니다.
                    가입시 입력한 이메일을 꼭 기억해 주세요.</div>
                <!-- 확인 버튼 -->
                <input type="submit" id="confirm_register" class="btn_confirm" value="확인"> 
            </div>
        </div>
        <script type="text/javascript">
            // $(document).ready(function() {
            //     // 인증번호 전송 버튼
            //     $('#btn_email_send').click(function() {
            //         var email = $('#email').val(); // 입력받은 이메일
            //         var inputBox = $('#email_verify'); // 인증번호 입력란
            //         var verifyBtn = $('#btn_email_verify'); //인증번호 확인 버튼
                    
            //         // 이메일 전송
            //         $.ajax({
            //             type:"POST",
            //             async : true,
            //             url:'/email',
            //             data : {
            //                 email: email,
            //             },
            //             success:function( authNum ){ // 이메일 전송 성공한 경우
            //                 console.log('인증번호 전송 성공');
            //                 // 이메일 전송 성공 팝업 띄우기



            //                 console.log("authNum : " + authNum);
            //                 inputBox.removeAttr('disabled'); // disabled 속성 삭제
            //             }, 
            //             error: function(err) { // POST 요청 실패시
            //                 console.log('인증번호 보내기 실패' + err);
            //             }
                                
            //         });


                    
            //     });
            // });

        </script>


        <script type="text/javascript">
            var modal_fail = document.querySelector(".modal_fail"); // 팝업 될 레이어 class명
            var modal_send = document.querySelector(".modal_send");
            var modal_check = document.querySelector(".modal_check");
            var modal_register = document.querySelector(".modal_register"); 
            
            var trigger_verify_fail = document.querySelector(".verify_fail_info"); // 인증번호 받기 실패 안내 버튼
            var trigger_send_verify = document.querySelector(".send_verify"); // 인증번호 받기 버튼
            var trigger_chk_verify = document.querySelector(".chk_verify"); // 인증번호 확인 버튼
            var trigger_register = document.querySelector(".register"); // 가입하기 버튼
            
            var closeFailButton = document.querySelector(".close_fail_button"); // 우측 상단 닫기 버튼
            var closeSendButton = document.querySelector(".close_send_button");
            var closeCheckButton = document.querySelector(".close_check_button");
            var closeRegisterButton = document.querySelector(".close_register_button");

            var confirmFailButton = document.querySelector("#confirm_fail"); // <- 확인 버튼 (취소 버튼 용으로 씀)
            var confirmSendButton = document.querySelector("#confirm_send");
            var confirmCheckButton = document.querySelector("#confirm_check");
            var confirmRegisterButton = document.querySelector("#confirm_register");

            var authNum; // 인증번호
            var isAuthChecked = false;
        
            function toggleFailModal() {
                modal_fail.classList.toggle("show_modal");
                
            }
            function toggleSendModal() {
                modal_send.classList.toggle("show_modal");
            }
            function toggleCheckModal() {
                modal_check.classList.toggle("show_modal");
            }
            function toggleRegisterModal() {
                console.log('toggle signup modal ㅁㄴㅇㄹ');
                modal_register.classList.toggle("show_modal");
            }
        
            function windowOnClick(event) {
                if (event.target === modal_fail) {
                    toggleFailModal();
                }
                else if (event.target === modal_send) {
                    toggleSendModal();
                } else if (event.target === modal_check) {
                    toggleCheckModal();
                    
                } else if (event.register === modal_register) {
                    toggleRegisterModal();
                }
            }

            function sendAuthEmail(event) {
                $(document).ready(function() {
                    // 인증번호 전송 버튼
                    $('#btn_email_send').click(function() {
                        var email = $('#email').val(); // 입력받은 이메일
                        var inputBox = $('#email_verify'); // 인증번호 입력란
                        var verifyBtn = $('#btn_email_verify'); //인증번호 확인 버튼
                        
                        // 이메일 전송
                        $.ajax({
                            type:"POST",
                            async : true,
                            url:'/email',
                            data : {
                                email: email,
                            },
                            success:function( data ){ // 이메일 전송 성공한 경우
                                console.log('인증번호 전송 성공');
                                toggleSendModal(); // 이메일 전송 성공 팝업 띄우기

                                authNum = data;
                                console.log("authNum : " + data);
                                inputBox.removeAttr('disabled'); // disabled 속성 삭제
                            }, 
                            error: function(err) { // POST 요청 실패시
                                console.log('인증번호 보내기 실패' + err);
                            }
                        });
                        
                    });
                });
            }

            function emailCheck(event) {
                //console.log('인증번호 확인');
                $(document).ready(function() {
                    $('#btn_email_verify').click(function() {
                        if ( $('#email_verify').val() == authNum) {
                            console.log('인증번호 확인 성공');
                            isAuthChecked = true;
                        } else {
                            alert('인증번호가 일치하지 않습니다.\n다시한번 확인해주세요');
                        }
                        
                        
                    });
                });
                
            }
            
            trigger_verify_fail.addEventListener("click", toggleFailModal);
            trigger_send_verify.addEventListener("click", sendAuthEmail);
            trigger_chk_verify.addEventListener("click", emailCheck);
            trigger_register.addEventListener("click", toggleRegisterModal);

            confirmFailButton.addEventListener("click", toggleFailModal);
            confirmSendButton.addEventListener("click", toggleSendModal);
            confirmCheckButton.addEventListener("click", toggleCheckModal);
            confirmRegisterButton.addEventListener("click", toggleRegisterModal);
            
            closeFailButton.addEventListener("click", toggleFailModal);
            closeSendButton.addEventListener("click", toggleSendModal);
            closeCheckButton.addEventListener("click", toggleCheckModal);
            closeRegisterButton.addEventListener("click", toggleRegisterModal);

            window.addEventListener("click", windowOnClick);
        
        </script>
    </div>
        
</body>
</html>