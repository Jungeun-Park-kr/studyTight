<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <script src="//code.jquery.com/jquery-1.11.0.min.js"></script>


<script type="text/javascript">   
    $(document).ready( function() {
        $("#header").load("/views/header.html");  
    });
    </script>

<style>@import url(/public/folder/folder.css);</style>
<link rel="stylesheet" href="/public/mainframe_shortcuts.css">
    <link rel="stylesheet" href="/public/mainframe.css">
    <link rel="stylesheet" href="/public/font.css">

    <link rel="stylesheet" type="text/css" href="/public/header.css"/>
    <link rel="stylesheet" type="text/css" href="/public/component.css"/>
</head>

<body>
    <div id="wrap">
        <div class="header" role="banner">
            <link rel="stylesheet" type="text/css" href="/public/header.css"/>
            <link rel="stylesheet" type="text/css" href="/public/component.css"/>
            <link rel="stylesheet" type="text/css" href="/public/font.css"/>
            <div class="main_header">
                <!-- 여기는 상단 헤더 (로고, 메뉴버튼들) -->
                <div class="logo_area">
                    <a href="#" class="logo_tight"><img src="/logo/logo_lower.png" class=img_logo onclick="location.href='/'" alt=""/></a>
                    <section class="group_menu">
                        <nav class="menu_effect" id="menu_nav">
                            <a href="/" class="menu" id="menu_home">내 공부방</a>
                            <a href="/guestbook" class="menu" id="menu_guestbook">방명록</a>
                            <a href="/timetable/main" class="menu" id="menu_timetable">시간표</a>
                        </nav>
                    </section>
                </div>
                <script type="text/javascript">   
                    $(document).ready( function() {
                        const location = window.location.pathname;
                        if (location == '/') {
                            $('#menu_home').addClass('menu_active');
                            $('#menu_guestbook').removeClass('menu_active');
                            $('#menu_timetable').removeClass('menu_active');
                        } else if (location == '/guestbook') {
                            $('#menu_guestbook').addClass('menu_active');
                            $('#menu_home').removeClass('menu_active');;
                            $('#menu_timetable').removeClass('menu_active');
                        } else if (location == '/timetable/main' || location == '/timetable/edit') {
                            $('#menu_timetable').addClass('menu_active');
                            $('#menu_home').removeClass('menu_active');
                            $('#menu_guestbook').removeClass('menu_active');
                        } else {
                            $('#menu_home').removeClass('menu_active');
                            $('#menu_guestbook').removeClass('menu_active');
                            $('#menu_timetable').removeClass('menu_active');
                        }
                        
                    });
                    
                </script>
                <div class="login">
                        <div class="profile_section">
                            <% if (user) { %> <%# 로그인 되어 있는 경우 (server에서 접속중인 user 정보 받아옴) %> 
                            <div class="alarm_bell">
                                <img id="alarm_bell_img" src="/public/media/bell_pure.png">
                            </div>
                            <div class="profile">
                                <!-- 이미지 클릭시 프로필 관리 화면으로 가는것도 좋을듯 -->
                                <img id="activeUserimg" src=<%= user.profile_image %>  onclick="location.href='#프로필수정화면'">
                                <div class="username" id="activeUsername"><%= user.name +'님'%></div> 
                            </div>
                            <div class="logout">
                                <input type="submit" class="btn_logout" title="로그아웃" value="로그아웃" onClick="location.href='/auth/logout'"/>    
                            </div>
                            <% } %>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div id="container">
            <div id="MAIN_LEFT">
                <div class="section">
                    <p class="folder_name">
                        <%= folder_title.folder_name%>
                    </p>
                    
                    <div id="wrap_postit" class="wrap_postit">
                        <% for(var i=0;i<postIt.length; i++) { %>
                            <div class="postIt postit">
                                <% if(postIt[i].fixed) { %>
                                    <img class="post_img" src=<%= postIt[i].postIt_color%>>
                                    <p class="post" onclick="showContent('<%= postIt[i].postIt_type %>','<%= postIt[i].postIt_name %>','<%= postIt[i].postIt_content %>');"><%= postIt[i].postIt_name%></p>
                                    <img class="fixed_star" src="/media/empty_star.png" onclick="starPostClicked('<%= postIt[i].postIt_name%>','<%= postIt[i].postIt_star %>');">
                                    <img class="three_button" src="media/three_button.png">
                                    <ul class="postIt_menu">
                                        <li><div id="revise_postIt" class="revise_postIt">수정</div></li>
                                        <li><div id="delete_postIt" onclick="deletePostClicked('<%= i %>');">삭제</div></li>    
                                    </ul>
                                <% }else { %>
                                    <img class="post_img" src=<%= postIt[i].postIt_color%>>
                                    <p class="post" onclick="showContent('<%= postIt[i].postIt_type %>','<%= postIt[i].postIt_name %>','<%= postIt[i].postIt_content %>');"><%= postIt[i].postIt_name%></p>
                                    <img class="fixed_star" src="/media/empty_star.png" onclick="starPostClicked('<%= i %>','<%= postIt[i]._id%>','<%= postIt[i].postIt_star %>');">
                                    <img class="three_button" src="media/three_button.png">
                                    <ul class="postIt_menu">
                                        <li><div id="revise_postIt" class="revise_postIt">수정</div></li>
                                        <li><div id="delete_postIt" onclick="deletePostClicked('<%= i %>');">삭제</div></li>    
                                    </ul>
                                <% } %>
                            </div>
                            <% } %>
                        </div>
                    <script>
                        const folder_id=JSON.parse('<%- JSON.stringify(folder_id) %>');
                        var star_toggle=1;
                        function starPostClicked(index,id, boolValue){ //제목으로 해야 mongodb에서 수정이 편리함
                                var clickedIndex;
                                
                                var clickedPost=document.getElementsByClassName('postit')[index];
                                var star_img=document.getElementsByClassName('fixed_star')[index];
                            

                                var currentValue=boolValue;
                                console.log("현재의 상태는 "+currentValue);
                                if(currentValue==true){
                                    star_toggle++;
                                }

                                if(star_toggle%2==1){
                                    currentValue=true;
                                    star_img.src='/media/full_star.png';
                                    star_img.style.opacity=1;

                                    //star_img를 full로 바꾸기

                                    fetch(''+folder_id+'/star',{
                                        method:'PATCH',
                                        headers:{
                                            'Accept':'application/json',
                                            'Content-Type':'application/json'
                                        },
                                        body:JSON.stringify({postIt_id:id,postIt_star:true})
                                        //.then(res => res.json( ))  
                                    });
                                    //fetch주소 바꾸기!
                                    //console.log("false에서 true로");
                                }else{
                                    currentValue=false;
                                    star_img.src='/media/empty_star.png';
                                    star_img.style.opacity=0;

                                    fetch(''+folder_id+'/star',{
                                        method:'PATCH',
                                        headers:{
                                            'Accept':'application/json',
                                            'Content-Type':'application/json'
                                        },
                                        body:JSON.stringify({postIt_id:id, postIt_star:false})
                                        //.then(res => res.json( ))  
                                    });
                                    console.log('true에서 false로!');
                                }
                            star_toggle++;
                        }
                        </script>
                
                <div id="modal" class="modal modal_show_content" data-backdrop="static">
                    <div class="modal-content-content">
                        
                        <span  class="close_button close_show_button" data-dismiss="modal" aria-hidden="true">&times;</span>
                        <h4 id='show_title' class="show_title" name="show_title"></h4> 
                        <!-- 여기에 CONTENT의 TITLE넣기 -->

                        <div class="modal-body" name="modal_show_body">
                            <p id="show_content" name="content" class="show_content"></textarea>
                            <!-- 여기에 CONTENT의 CONTENT넣기 -->
                        </div>
                        
                    </div>
                </div>
    <script>

        function addNewPost(type,post, post_color){ //동적 추가용
            var post_name=post.post_name;
            var post_content=post.post_content;
            var post_star=post.post_star;

            var parent_post=document.getElementById('wrap_postit');

            var wrap=document.createElement('div');
            wrap.setAttribute('class','postIt');
            wrap.setAttribute('class','postit')

            var post_img=document.createElement('img');
            post_img.setAttribute('class','post_img');
            post_img.setAttribute('src',post_color);

            var post_p=document.createElement('p');
            post_p.setAttribute('class','post');
            post_p.innerHTML=post_name;
        
            var star_img=document.createElement('img');
            star_img.setAttribute('class','fixed_star');
            star_img.setAttribute('src','/media/empty_star.png');
            star_img.addEventListener('click',function(){

            }); 

            
            wrap.append(post_img);
            wrap.append(post_p);
            wrap.append(star_img);
            
            parent_post.append(wrap);

            if(type=='content'){
                post_p.addEventListener('click',function(){
                
                document.getElementById('show_title').innerHTML=post_name;
                document.getElementById('show_content').innerHTML=post_content;
                toggleShowModal();
            });
            }else if(type=='link'){
                post_p.addEventListener('click',function(){
                    var link=window.open();
                    link.location=post_content;
            })
            }else{ //type=='file'
                ;
            }

        }

                </script>

<div id="postIt_plus" class="postIt">
    <img src="/media/folder_black.svg"/>
    <p class="post">추가하기</p>
</div>


    <div id="modal" class="modal modal_choice" data-backdrop="static">
        <div class="modal-content-choice">
            
            <span  class="close_button close_choice_button" data-dismiss="modal" aria-hidden="true">&times;</span>
            <h4 class="title">포스트잇 추가하기</h4>
            
            <div class="modal-body">작성할 종류를 선택하세요.
            <br>
            
            <div class="choice choice_content">
                <img src="media/content.png" ><p>글</p></div>
            <div class="choice choice_link">
                <img src="media/link.png"><p>링크</p></div>
            <div class="choice choice_file">
            <img src="media/file.png"><p>파일</p></div>
            </div>
        </div>
    </div>

    
    <!-- 글 저장하기 -->
    <div id="modal" class="modal modal_content" data-backdrop="static">
        <div class="modal-content-content">
            
            <span  class="close_button close_content_button" data-dismiss="modal" aria-hidden="true">&times;</span>
            <h4 class="title">글 작성하기</h4>
        
            <div class="modal-body">
                <p>제목</p>
                <input type="text" id="input_content_title" name="title" class="input_text" placeholder="제목을 입력하세요">
                <br>
                <br>
                <p>내용</p>
                <textarea id="input_content" name="content" class="input_content" row="38" cols="38" name="contents" placeholder="내용을 입력하세요"></textarea>
            </div>
            <div class="modal-footer">
                <div class="content_color_wrap" value="포스트잇의 색을 선택하세요.">
                    <select id="content_color" name="content_color"> 
                    <option value='/public/media/folder_orange.svg' style="background-color: #f29b34;">주황색</option>
                    <option value='/public/media/folder_green.svg' style='background-color: #97ce68;'>연두색</option>
                    <option value='/public/media/folder_yellow.svg' style='background-color: #fcd341;'>노란색</option>
                    <option value='/public/media/folder_red.svg' style='background-color: #e36363;'>다홍색</option>
                    <option value='/public/media/folder_mint.svg' style='background-color: #4dbdc2;'>하늘색</option>

                
                    </select>
                </div>
            <!-- <a href="#" data-dismiss="modal" class="btn cancelBtn" onclick="cancelClicked();">취소</a>
            <a href="#" class="btn uploadBtn" onclick="uploadContent();">완료</a> -->
                <div data-dismiss="modal" class="btn cancelBtn cancel_content_button" onclick="cancelClicked();">취소</div>
                <div class="btn uploadBtn store_content_button" onclick="uploadContent();">완료</div>
            </div>
        </div>
    </div>

    <!-- 링크 저장하기 -->
    <div id="modal" class="modal modal_link" data-backdrop="static">
        <div class="modal-content-link">
        
            <span  class="close_button close_link_button" data-dismiss="modal" aria-hidden="true">&times;</span>
            <h4 class="modal-title">링크 작성하기</h4>
            
            <div class="modal-body">               
                <p>제목</p>
                <input type="text" id="input_link_title" class="input_text" placeholder="제목을 입력하세요">
                <br>
                <br>
                <p>링크</p>
                <input type="url" id="input_link" class="input_link" placeholder="링크를 입력하세요">
            </div>
            <div class="modal-footer">
                <div class="link_color_wrap" value="포스트잇의 색을 선택하세요.">
                    <select id="link_color" name="link_color"> 
                    <option value='/public/media/folder_orange.svg' style="background-color: #f29b34;">주황색</option>
                    <option value='/public/media/folder_green.svg' style='background-color: #97ce68;'>연두색</option>
                    <option value='/public/media/folder_yellow.svg' style='background-color: #fcd341;'>노란색</option>
                    <option value='/public/media/folder_red.svg' style='background-color: #e36363;'>다홍색</option>
                    <option value='/public/media/folder_mint.svg' style='background-color: #4dbdc2;'>하늘색</option>
                
                </select>
                </div>
                <div data-dismiss="modal" class="btn cancelBtn cancel_link_button" onclick="cancelClicked();">취소</div>
                <div class="btn uploadBtn store_link_button" onclick="uploadLink();">완료</div>
            </div>
        
        </div>
    </div>

        <!-- 파일 저장하기 -->
        <div id="modal" class="modal modal_file" data-backdrop="static">
            <div class="modal-content-file">
            
                <span  class="close_button close_file_button" data-dismiss="modal" aria-hidden="true">&times;</span>
                <h4 class="modal-title">파일 작성하기</h4>
    
                
                
                <div class="modal-body">
                        <p>제목</p>
                        <input type="text" id="input_file_text" class="input_text" placeholder="제목을 입력하세요">
                        <br>
                        <br>
                        <div class="filebox"> 
                            <input class="upload-name" value="파일선택" disabled="disabled">
                            <label for="ex_filename">업로드</label> 
                            <input type="file" id="ex_filename" class="upload-hidden">
                        </div>
                        </div>
                        <div class="modal-footer">
                            <div class="file_color_wrap" value="포스트잇의 색을 선택하세요.">
                                <select id="file_color" name="file_color"> 
                                <option value='/public/media/folder_orange.svg' style="background-color: #f29b34;">주황색</option>
                                <option value='/public/media/folder_green.svg' style='background-color: #97ce68;'>연두색</option>
                                <option value='/public/media/folder_yellow.svg' style='background-color: #fcd341;'>노란색</option>
                                <option value='/public/media/folder_red.svg' style='background-color: #e36363;'>다홍색</option>
                                <option value='/public/media/folder_mint.svg' style='background-color: #4dbdc2;'>하늘색</option>
                            
                            </select>
                            </div>
                            <div data-dismiss="modal" class="btn cancelBtn cancel_file_button" onclick="cancelClicked();">취소</div>
                            <div class="btn uploadBtn store_file_button" onclick="uploadFile();">완료</div>
                        </div>
                    
                
            </div>
            </div>
    
    <script>
        var modal_choice=document.querySelector('.modal_choice');
        var modal_content=document.querySelector('.modal_content');
        var modal_link=document.querySelector('.modal_link');
        var modal_file=document.querySelector('.modal_file');
        var trigger_choice_button=document.querySelector('#postIt_plus');
        var trigger_content_button=document.querySelector('.choice_content');
        var trigger_link_button=document.querySelector('.choice_link');
        var trigger_file_button=document.querySelector('.choice_file')
        var close_choice_button=document.querySelector('.close_choice_button');
        var close_content_button=document.querySelector('.close_content_button');
        var close_link_button=document.querySelector('.close_link_button');
        var close_file_button=document.querySelector('.close_file_button');
        var store_content_button=document.querySelector('.store_content_button');
        var store_link_button=document.querySelector('.store_link_button');
        var store_file_button=document.querySelector('.store_file_button');
        var cancel_content_button=document.querySelector('.cancel_content_button');
        var cancel_link_button=document.querySelector('.cancel_link_button');
        var cancel_file_button=document.querySelector('.cancel_file_button');

        var modal_show_content=document.querySelector('.modal_show_content');
        var close_show_button=document.querySelector('.close_show_button');


        function toggleChoiceModal(){
            modal_choice.classList.toggle('show_modal');
        }
        function toggleContentModal(){
            modal_content.classList.toggle('show_modal');
        }
        function toggleLinkModal(){
            modal_link.classList.toggle('show_modal');
        }
        function toggleFileModal(){
            modal_file.classList.toggle('show_modal');
        }
        function toggleShowModal(){
            modal_show_content.classList.toggle('show_modal');
        }
        
        function windowOnClick(event){
            if(event.target===modal_choice){
                toggleChoiceModal();
            }else if(event.target===modal_content){
                toggleContentModal();
            }else if(event.target===modal_link){
                toggleLinkModal();
            }else if(event.target===modal_file){
                toggleFileModal();
            }else if(event.target===modal_show_content){
                toggleShowModal();
            }

        }

        trigger_choice_button.addEventListener('click',toggleChoiceModal);
        close_choice_button.addEventListener('click',toggleChoiceModal);

        trigger_content_button.addEventListener('click',toggleContentModal);
        trigger_content_button.addEventListener('click',toggleChoiceModal);
        close_content_button.addEventListener('click',toggleContentModal);
        cancel_content_button.addEventListener('click',toggleContentModal);
        store_content_button.addEventListener('click',toggleContentModal);

        trigger_link_button.addEventListener('click',toggleLinkModal);
        trigger_link_button.addEventListener('click',toggleChoiceModal);
        close_link_button.addEventListener('click',toggleLinkModal);
        cancel_link_button.addEventListener('click',toggleLinkModal);
        store_link_button.addEventListener('click',toggleLinkModal);

        trigger_file_button.addEventListener('click',toggleFileModal);
        trigger_file_button.addEventListener('click',toggleChoiceModal);
        close_file_button.addEventListener('click',toggleFileModal);
        cancel_file_button.addEventListener('click',toggleFileModal);
        store_file_button.addEventListener('click',toggleFileModal);
        
        close_show_button.addEventListener('click',toggleShowModal);

        function uploadContent(){
            const folder_id=JSON.parse('<%- JSON.stringify(folder_id) %>');
            //console.log(folder_name);
            const title=$('#input_content_title').val();
            const content=$('#input_content').val();
            const color=$('#content_color option:selected').val();
            if(title.trim()==''){
                alert("제목을 입력해주세요.");
            }else if(content.trim()==''){
                alert("내용을 입력해주세요.");
            }else{
                var new_post;
                $.ajax({
                    type:'POST',
                    async:true,
                    url:''+folder_id+'/add',
                    data:{
                        folder_id:folder_id,
                        postIt_name:title,
                        postIt_content:content,
                        postIt_type:'content',
                        postIt_star:false,
                        postIt_color:color

                    },
                    success:function(data){
                        //console.log('포스트잇 글 저장 완료');
                        var new_post={
                            post_name:title,
                            post_content:content,
                            post_star:false
                        }
                        addNewPost('content',new_post,color);
                    },error:function(err){
                        console.log('포스트잇 글 저장 실패');
                    }
                })
            }
        }




        function uploadLink(){
            const folder_id=JSON.parse('<%- JSON.stringify(folder_id) %>');
            //console.log(folder_name);
            const title=$('#input_link_title').val();
            const link=$('#input_link').val();
            const color=$('#link_color option:selected').val();
            if(title.trim()==''){
                alert("제목을 입력해주세요.");
            }else if(link.trim()==''){
                alert("링크를 입력해주세요.");
            }else{
                var new_post;
                
                $.ajax({
                    type:'POST',
                    async:true,
                    url:''+folder_id+'/add',
                    data:{
                        folder_id:folder_id,
                        postIt_name:title,
                        postIt_type:'link',
                        postIt_content:link,
                        postIt_star:false,
                        postIt_color:color

                    },
                    success:function(data){
                        //console.log('포스트잇 링크 저장 완료');
                        var new_post={
                            post_name:title,
                            post_content:link,
                            post_star:false
                        }
                        addNewPost('link',new_post,color);
                    },error:function(err){
                        //console.log('포스트잇 링크 저장 실패');
                    }
                })
            }
        }
        


        function showContent(type, title, content){
            if(type=='link'){
                var link=window.open();
                link.location=content;
            }else if(type=='content'){
                ; //modal로 띄우기 모달 안에는 제목, 내용, 취소 버튼만 있으면 된다.
                var show_title=title;
                var show_content=content;
                document.getElementById('show_title').innerHTML=show_title;
                document.getElementById('show_content').innerHTML=show_content;
                toggleShowModal();
            }else { //type=='file'
                ;
            }

        }

    </script>

    
            </div>
        </div>
                <div id="MAIN_RIGHT" class='column_right'>
                    <div class="aside">
                        <div class="aside_wrap">
                            <p>오늘 할 일</p>
                            
                            <div class="todaylist" id="todaylist">
                                
                                
                                <div class="todaylists" id='todaylists'>
                                    <!-- todolist 뿌려주기 -->
                                    
                                <% for(var i=0;i<todolist.length; i++) { %>
                                
                                    <input type="hidden" value="<%=todolist[i].todo_content%>" class="todolist-id"/>
                                    <% if(todolist[i].todo_finished) {%>
                                        <div class='wrap_label'><label class='label'><input type="checkbox" checked name='checkbox' onclick="onCheckedHandler('<%= todolist[i].todo_content %>',true)" class="checkbox">
                                            <p style='text-decoration: line-through;' class="p_p"><%= todolist[i].todo_content %></p></label><span class='delete_todo' onclick="onDeleteTodo('<%= todolist[i].todo_content %>','<%= i %>')">&times;</span></div>
                                    <%} else{ %>
                                        <div class='wrap_label'><label class='label'><input type="checkbox" name='checkbox' onclick="onCheckedHandler('<%= todolist[i].todo_content %>',false)" class="checkbox">
                                            <p style='text-decoration: none;'class="p_p"><%= todolist[i].todo_content %></p></label><span class='delete_todo' onclick="onDeleteTodo('<%= todolist[i].todo_content %>','<%= i %>')">&times;</span></div>
                                        <% } %>
                                    <% } %>
                                    <!-- </form> -->
                                    <!-- if문을 통해서 해당 todolist[i].todo_finished값이 true라면 checkbox에 checked로 띄워지게! -->
                                </div>
                                <input type="submit" data-toggle="modal" data-target="#modal_todo" class="btnplusTodo" value="+   할 일 추가하기"></input>
                            </div>
                            
                            <script>
                            
                                var checked_toggle=1;
                                //모달에서 추가하기를 눌렀을 때 값이 다시 업데이트가 되도록 mongodb에서 값 가져오기..
                                function onCheckedHandler(todo_content, boolValue){ //해당 _id값이 넘어온 것이니까 //mongodb에서 수정하기 위해서
                                    var checkedIndex;
                                    var checkedBox=document.getElementsByClassName('checkbox');
                                    var hidden_input=document.getElementsByClassName('todolist-id');
                                    for(var i=0;i<hidden_input.length;i++){
                                        if(hidden_input[i].value==todo_content){
                                            checkedIndex=i;
                                        }
                                    }
                                    var currentState=boolValue;
                                    //console.log(currentState+'->'+!(currentState));
                                    if(currentState==true){
                                        checked_toggle++;
                                    }
                                    var content=document.getElementsByClassName('p_p');
                                    if(checked_toggle%2==1){ //unchecked -> checked
                                        content[checkedIndex].style.textDecoration='line-through';
                                        currentState=true;
                                        
                                        fetch('/',{
                                            method:'PATCH',
                                            headers:{
                                                'Accept':'application/json',
                                                'Content-Type':'application/json'
                                            },
                                            body:JSON.stringify({user_id:'<%= user.name %>',todo_content:content[checkedIndex].innerHTML, todo_finished:true})
                                            //.then(res => res.json( ))  
                                        });
                                        
                                    }else{   //checked -> unchecked
                                        content[checkedIndex].style.textDecoration='none';
                                        content[checkedIndex].setAttribute('checked',false);
                                        
                                        currentState=false;
                                        fetch('/',{
                                            method:'PATCH',
                                            headers:{
                                                'Accept':'application/json',
                                                'Content-Type':'application/json'
                                            },
                                            body:JSON.stringify({user_id:'<%= user.name %>',todo_content:content[checkedIndex].innerHTML, todo_finished:false})
                                            //.then(res => res.json())  
                                        });
    
                                    }      
                                        checked_toggle++;
                                                           }
                                
                                function onDeleteTodo(todo_content,delete_index){
                                    var parent=document.getElementById('todaylists');
                                    
                                    var delete_div=document.getElementsByClassName('wrap_label')[delete_index];
                                    //console.log(delete_index);
                                
                                    //db에 삭제되도록 하기
                                    fetch('/',{
                                            method:'DELETE',
                                            headers:{
                                                'Accept':'application/json',
                                                'Content-Type':'application/json'
                                            },
                                            body:JSON.stringify({user_id:'<%= user.name %>',todo_content:todo_content})
                                            //.then(res => res.json())   
                                        });
                                        parent.removeChild(delete_div);
                                        alert(todo_content+'이(가) 오늘 할 일에서 삭제되었습니다.');
                                }
                            
                            </script>
    
                            
                            <!--+부분 이미지로 넣기-->
                            
                            <div class="caution">
                                오늘(11:59 PM)기준으로 완료된 할 일은<br>내일(12:00 AM)기준으로 제거되고,<br>완료되지 않은 할 일은 유지됩니다.
                            </div>
                    </div>
                    </div>

                    <div id="modal_todo" class="modal modal_todo">
                        <div class="modal-content-todo">
                        <span class="close_button close_todo_button">&times;</span>
                        <h1 class="title">오늘 할 일 추가히기</h1>
                            <div>
                                <input type="text" id="modal-todo" name="todo_content" maxlength="10" placeholder="할 일을 작성해보세요.">
                                <input type="hidden">
                            </div>
                            <div>
                                <input type="button" class="modal-todo-plus" value="확인"></input>
                            </div>
                        
                        </div>
                    </div>
                
                <script type='text/javascript'>
                    var modal_todo=document.querySelector(".modal_todo");
                    var trigger_todo=document.querySelector(".btnplusTodo"); //todo 추가하기 버튼
                    var closeTodoButton=document.querySelector('.close_todo_button');
                    var storeTodoButton=document.querySelector('.modal-todo-plus');

                function toggleTodoModal(){
                    modal_todo.classList.toggle("show_modal");
                }

                function windowOnClick(event){
                    if(event.target===modal_todo){
                        toggleTodoModal();
                    }
                }

                trigger_todo.addEventListener("click",toggleTodoModal);
                closeTodoButton.addEventListener('click',toggleTodoModal);
                storeTodoButton.addEventListener('click',toggleTodoModal);

                $('.modal-todo-plus').click(function(event){
                    const folder_id=JSON.parse('<%- JSON.stringify(folder_id) %>')
                    var new_content=$('#modal-todo').val();
                    //var new_todo_id=todolist._id;
                    if(new_content.trim()===''){ //내용을 입력하지 않은 경우
                        alert("내용을 입력해주세요.");}
                    else{
                        var new_todolist;
                        $.ajax({
                            type:'POST',
                            async:true,
                            url:''+folder_id+'/todo',
                            data:{
                                todo_content:new_content,
                                todo_finished:false
                            },
                    
                            success:function(data){
                                var new_todo = {
                                    todo_content : new_content,
                                    todo_finished : false
                                }
                                addNewTodo(new_todo);
                            },error:function(err){
                                console.log('todo 저장 실패');
                            }
                        });
                    }
                })

                function addNewTodo(todolist){
    
    var content=todolist.todo_content;

    var parent_todolist=document.getElementById('todaylists');
    
    var new_div=document.createElement('div');
    new_div.setAttribute('class','wrap_label');
    var new_input=document.createElement('input');
    new_input.setAttribute('type','hidden');
    new_input.setAttribute('value',content);
    new_input.setAttribute('class','todolist-id')
    var new_label=document.createElement('label');
    new_label.setAttribute('class','label');
    var new_checkbox=document.createElement('input');
    new_checkbox.setAttribute('type','checkbox');
    new_checkbox.setAttribute('name','checkbox');
    new_checkbox.setAttribute('class','class');
    //new_checkbox.setAttribute('onclick','onCheckedHandler('+content+','+false+')')
    // 이 값을 함수 호출하는 곳에서 가져와야 함...
    var new_p=document.createElement('p');
    new_p.setAttribute('class','p_p');
    new_p.innerHTML=content;
    var new_span=document.createElement('span');
    new_span.setAttribute('class','delete_todo');
    //new_span.setAttribute('onclick','onDeleteTodo('+content+')')
    
    var new_ck_toggle=1;
    new_checkbox.addEventListener('click',function(){
        
        var check_content=todolist.todo_content;
        console.log(check_content);
        var check_value=todolist.todo_finished;
        //onCheckedHandler(content,check_value);
        //console.log(check_value+'->'+!(check_value));
        if(check_value==true){
            new_ck_toggle++;
        }
        if(new_ck_toggle%2==1){
            new_p.style.textDecoration='line-through';
            check_value=true;

            fetch('/',{
                method:'PATCH',
                headers:{
                'Accept':'application/json',
                'Content-Type':'application/json'
            },
            body:JSON.stringify({user_id:'<%= user.name %>',todo_content:new_p.innerHTML, todo_finished:true})
            //.then(res => res.json( ))  
            });
        }else{
            new_p.style.textDecoration='none';
            check_value=false;
            fetch('/',{
                method:'PATCH',
                headers:{
                    'Accept':'application/json',
                    'Content-Type':'application/json'
                    },
                body:JSON.stringify({user_id:'<%= user.name %>',todo_content:new_p.innerHTML, todo_finished:false})
                //.then(res => res.json())  
                });
        }
        new_ck_toggle++;
    });

    new_span.innerHTML='&times;'

    parent_todolist.append(new_div);
    new_div.append(new_label);
    new_label.append(new_checkbox);
    new_label.append(new_p);
    new_div.append(new_span);

    new_span.addEventListener('click',function(){
        //삭제했을 때 바뀌도록 ... delete함수 사용
        fetch('/',{
            method:'DELETE',
            headers:{
                'Accept':'application/json',
                'Content-Type':'application/json'
                },
            body:JSON.stringify({user_id:'<%= user.name %>',todo_content:new_p.innerHTML})
            //.then(res => res.json())   
            });
            alert(new_p.innerHTML+'이(가) 오늘 할 일에서 삭제되었습니다.');
            parent_todolist.removeChild(new_div);
    });
}
                </script>
                
                </div>

    </div>

    <script>
        function cancelClicked(){
            alert("포스트잇 작성이 취소되었습니다.");
        }
    </script>

    <!-- </div> -->
    </body>
</html>
